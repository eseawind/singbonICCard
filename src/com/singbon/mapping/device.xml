<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.singbon.dao.systemManager.DeviceDAO">
	<resultMap id="device" type="com.singbon.entity.Device">
	</resultMap>
	<parameterMap type="com.singbon.entity.Device" id="device2" />
	<cache eviction="FIFO" size="2000" readOnly="true"/>

	<insert id="insert" parameterMap="device2">
		insert into device (companyId,deptId,posParamGroupId,deviceName,deviceNum,deviceType,enable,sn)
		values (#{companyId},#{deptId},#{posParamGroupId},#{deviceName},#{deviceNum},#{deviceType},#{enable},#{sn})
	</insert>
	<update id="update" parameterMap="device2">
		update device set posParamGroupId=#{posParamGroupId},deviceName=#{deviceName},deviceNum=#{deviceNum},deviceType=#{deviceType},enable=#{enable},sn=#{sn}
		where id=#{id}
	</update>
	<delete id="delete">
		delete from device where id=#{id}
	</delete>
	<select id="selectById" resultMap="device">
		select * from device where id=#{id}
	</select>
<!-- 	添加修改机器验证 -->
	<select id="selectCountByInfo" resultType="java.util.Map" parameterMap="device2" useCache="false">
		select 
			(select count(*) from device where deviceNum=#{deviceNum}
			<if test="id!=null">
			     and id!=#{id}
			</if>
			) numCount,
			(select count(*) from device where sn=#{sn}
			<if test="id!=null">
			     and id!=#{id}
			</if>
			) snCount
	</select>
	<select id="selectDeviceListByCompanyId" resultMap="device" useCache="false">
		select * from device where companyId=#{companyId}		
		<if test="isCardReader == 1">
			 and deviceType=8
		</if>
		<if test="isCardReader == 0">
			 and deviceType!=8
		</if>
		<if test="onlyEnable == 1">
			 and enable=1
		</if>
	</select>
<!-- 	查询读卡机被引用数量 -->
	<select id="selectSysUserCountByDeviceId" resultType="java.lang.Integer" useCache="false">
		select count(*) count from sysUser where deviceId=#{deviceId}		
	</select>
<!-- 	系统启动加载用 -->
	<select id="selectAllList" resultMap="device" useCache="false">
		select * from device
	</select>
</mapper>
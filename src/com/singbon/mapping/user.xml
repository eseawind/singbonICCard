<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.singbon.dao.mainCard.MainCardDAO">
	<resultMap id="user" type="com.singbon.entity.User">
	</resultMap>
	<parameterMap type="com.singbon.entity.User" id="user2" />
	<insert id="insert" parameterMap="user2" useGeneratedKeys="true" keyProperty="userId">
		insert into user
		(companyId,deptId,username,shortName,userNO,sex,cardID,cardNO,cardSN,cardSeq,cardType,cardFunc,cardIdentity,status,beginDate,invalidDate,cardMakeDate,consumePwd,identityPwd,totalFare,oddFare,opCount)
		values
		(#{companyId},#{deptId},#{username},#{shortName},#{userNO},#{sex},#{cardID},#{cardNO},#{cardSN},#{cardSeq},#{cardType},#{cardFunc},#{cardIdentity},#{status},#{beginDate},#{invalidDate},#{cardMakeDate},#{consumePwd},#{identityPwd},#{totalFare},#{oddFare},#{opCount})
	</insert>
	<update id="update" parameterMap="user2">
		update user set
		username=#{username},shortName=#{shortName},userNO=#{userNO},sex=#{sex},cardID=#{cardID},cardType=#{cardType},cardFunc=#{cardFunc},cardIdentity=#{cardIdentity},endDate=#{endDate},consumePwd=#{consumePwd},identityPwd=#{identityPwd}
		where userId=#{userId}
	</update>
	<update id="infoCard" parameterMap="user2">
		update user set cardNO=#{cardNO},cardSN=#{cardSN},cardSeq=1,status=1,cardMakeDate=now(),totalFare=#{totalFare},oddFare=#{oddFare},opCount=#{opCount}
		where userId=#{userId}
	</update>
	<update id="remakeCard" parameterMap="user2">
		update user set cardNO=#{cardNO},cardSN=#{cardSN},cardSeq=#{cardSeq},status=1
		where userId=#{userId}
	</update>
	<update id="changeStatus">
		update user set status=#{status}
		where userId=#{userId}
	</update>
	<update id="changeNewCard">
		update user set cardNO=#{cardNO},cardSN=#{cardSN},cardSeq=cardSeq+1
		where userId=#{userId}
	</update>
	<delete id="delete" parameterType="int">
		delete from user where status=0 and deptId=#{deptId}
	</delete>
	<select id="selectById" resultMap="user">
		select * from user where userId=#{userId}
	</select>
	<select id="selectByUserIdCardSN" resultMap="user">
		select * from user where companyId=#{companyId} and userId=#{userId} and cardSN=#{cardSN}
	</select>
	<select id="selectMaxCardNO" resultType="java.lang.Integer">
		select ifnull(max(cardNO),0)+1 cardNO from user where companyId=#{companyId}
	</select>
	<select id="selectCountByCardSN" resultType="java.lang.Integer">
		select count(userId) from user where companyId=#{companyId} and cardSN=#{cardSN}
	</select>
	<select id="selectCountByUserNO" resultType="java.lang.Integer">
		select count(userId) from user where companyId=#{companyId} and userNO=#{userNO}
	</select>
	<select id="selectCountByUserNOUserId" resultType="java.lang.Integer">
		select count(userId) from user where companyId=#{companyId} and userNO=#{userNO} and userId!=#{userId}
	</select>
	<select id="selectByCondition" resultMap="user">
		select * from user
		<where>
			<if test="deptId!=null and deptId > 0">
				and deptId=#{deptId}
			</if>
			<if test="searchStr!=null">
				and (
				username like concat('%',#{searchStr},'%')
				or shortName like concat('%',#{searchStr},'%')
				or userNO like concat('%',#{searchStr},'%')
				)
			</if>
		</where>
	</select>
</mapper>
